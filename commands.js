/*! For license information please see commands.js.LICENSE.txt */
!function(){var e={63924:function(e,t,n){var o=n(64583).Promise,r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=o))((function(o,i){function c(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}a((r=r.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,o,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=s(0),c.throw=s(1),c.return=s(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};!function(){"use strict";function e(){if("OutlookIOS"===Office.context.mailbox.diagnostics.hostName)return console.log("Host is OutlookIOS, returning EWS Item ID."),Office.context.mailbox.item.itemId;console.log("Host is not OutlookIOS, converting EWS ID to REST ID v2.0.");try{return Office.context.mailbox.convertToRestId(Office.context.mailbox.item.itemId,Office.MailboxEnums.RestVersion.v2_0)}catch(e){throw console.error("Error converting Item ID to REST ID:",e),new Error("Could not convert Item ID to REST ID.")}}function t(){return i(this,void 0,void 0,(function(){return c(this,(function(t){return console.log("Attempting to fetch .eml blob..."),[2,new o((function(t,n){Office.context.mailbox.getCallbackTokenAsync({isRest:!0},(function(o){var r;if(o.status!==Office.AsyncResultStatus.Succeeded)return console.error("Error getting REST callback token:",o.error),void n(new Error("Failed to get REST callback token: "+(null===(r=o.error)||void 0===r?void 0:r.message)));console.log("Successfully obtained REST callback token.");var i=o.value,c=e(),s="".concat(Office.context.mailbox.restUrl,"/v2.0/me/messages/").concat(c,"/$value");console.log("Fetching from URL: ".concat(s)),fetch(s,{method:"GET",headers:new Headers({Authorization:"Bearer ".concat(i),Accept:"application/octet-stream"})}).then((function(e){return console.log("Fetch response status: ".concat(e.status," ").concat(e.statusText)),e.ok?e.blob():e.text().then((function(t){throw console.error("Fetch Error Body:",t),new Error("Error fetching .eml message (".concat(e.status,"): ").concat(e.statusText,". ").concat(t))}))})).then((function(e){console.log("Successfully fetched .eml blob, size: ".concat(null==e?void 0:e.size,", type: ").concat(null==e?void 0:e.type)),t(e)})).catch((function(e){console.error("Fetch .eml error:",e),n(e)}))}))}))]}))}))}Office.initialize=function(e){console.log("Office.initialize called. Reason: ".concat(e))},Office.actions.associate("validateBeforeSend",(function(n){return i(this,void 0,void 0,(function(){var s,a,l,u;return c(this,(function(f){switch(f.label){case 0:console.log("--- validateBeforeSend started ---"),s=Office.context.mailbox.item,a=null,f.label=1;case 1:return f.trys.push([1,4,,5]),console.log("Step 1: Fetching .eml content..."),[4,t()];case 2:if(!(l=f.sent())||null==l)throw new Error("Fetched email blob is invalid or empty.");return console.log("Step 1: Fetching .eml content successful."),console.log("Step 2: Opening dialog..."),[4,new o((function(t,u){Office.context.ui.displayDialogAsync("https://shahzadumar-w.github.io/Boligflow_Outlook_integration/ReactDialog.html",{height:75,width:50,displayInIframe:!0},(function(f){var d=this;f.status===Office.AsyncResultStatus.Succeeded?(a=f.value,console.log("Step 2: Dialog opened successfully."),console.log("Step 3: Setting up dialog event handlers..."),a.addEventHandler(Office.EventType.DialogEventReceived,(function(e){console.error("Dialog Event Error: Code=".concat(e.error,", Message='").concat(e.message||"N/A","'")),12006===e.error&&(console.log("Dialog closed by user or navigated away."),n&&"function"==typeof n.completed&&n.completed({allowEvent:!1,errorMessage:"Operation cancelled."}));try{a&&a.close()}catch(e){}})),a.addEventHandler(Office.EventType.DialogMessageReceived,(function(t){return i(d,void 0,void 0,(function(){var u,f,d,h,p,g,v,m=this;return c(this,(function(y){switch(y.label){case 0:if(console.log("Message received from dialog: ".concat(t.message)),"data_request"!==t.message)return[3,9];console.log("Processing 'data_request'..."),y.label=1;case 1:return y.trys.push([1,7,,8]),console.log("Step 4: Fetching attachment content..."),u=[],s.attachments&&s.attachments.length>0?[4,o.all(s.attachments.map((function(e){return i(m,void 0,void 0,(function(){return c(this,(function(t){return console.log("Fetching content for: ".concat(e.name," (ID: ").concat(e.id,", Type: ").concat(e.attachmentType,")")),[2,new o((function(t,n){if(e.name,Office.CoercionType.Text,e.attachmentType===Office.MailboxEnums.AttachmentType.Item)return console.warn("Skipping item attachment content fetch: ".concat(e.name)),void t({id:e.id,name:e.name,contentType:"message/rfc822",size:e.size,isInline:e.isInline,attachmentType:e.attachmentType,content:null,format:null,error:"Item attachment content not fetched via getAttachmentContentAsync"});s.getAttachmentContentAsync(e.id,{asyncContext:e.name},(function(o){var r;o.status!==Office.AsyncResultStatus.Succeeded?(console.error("Failed content fetch for ".concat(o.asyncContext,":"),o.error),n(new Error("Failed to get content for: ".concat(o.asyncContext,": ").concat(null===(r=o.error)||void 0===r?void 0:r.message)))):(console.log("Success content fetch for: ".concat(o.asyncContext,", Format: ").concat(o.value.format)),t({id:e.id,name:e.name,contentType:e.contentType,size:e.size,isInline:e.isInline,attachmentType:e.attachmentType,content:o.value.content,format:o.value.format,error:null}))}))}))]}))}))})))]:[3,3];case 2:return u=y.sent(),console.log("Step 4: Attachment content fetching complete."),[3,4];case 3:console.log("Step 4: No attachments found on the item."),y.label=4;case 4:return console.log("Step 5: Converting .eml blob to base64..."),[4,(b=l,new o((function(e,t){var n=new FileReader;n.onerror=function(e){console.error("FileReader Error:",e),t(new Error("Failed to read blob for base64 conversion."))},n.onload=function(){try{var o=n.result.split(",")[1];o?e(o):(console.warn("Base64 conversion resulted in empty string."),e(""))}catch(e){console.error("Error processing FileReader result:",e),t(new Error("Error extracting base64 string from FileReader result."))}},n.readAsDataURL(b)})))];case 5:return f=y.sent(),console.log("Step 5: .eml conversion complete."),console.log("Step 6: Constructing emailData payload..."),d=s.from||s.sender,[4,new o((function(e){s.body&&"function"==typeof s.body.getAsync?s.body.getAsync(Office.CoercionType.Text,{asyncContext:"bodyPreview"},(function(t){t.status===Office.AsyncResultStatus.Succeeded?e(t.value.substring(0,500)):(console.warn("Could not get body preview:",t.error),e("Could not get body preview."))})):e("Body preview not available.")}))];case 6:return h=y.sent(),p={itemId:s.itemId,restItemId:e(),subject:s.subject||"",from:{displayName:(null==d?void 0:d.displayName)||"Unknown Sender",emailAddress:(null==d?void 0:d.emailAddress)||"unknown@example.com"},toRecipients:s.to||[],ccRecipients:s.cc||[],bccRecipients:s.bcc||[],bodyPreview:h,attachments:u.filter((function(e){return!e.error})),emailContentBase64:f,errors:u.filter((function(e){return e.error})).map((function(e){return e.error}))},console.log("Step 6: Payload constructed. Sending to dialog (logging structure only)..."),g=r(r({},p),{attachments:p.attachments.map((function(e){return r(r({},e),{content:e.content?"[Base64 Content Present - Length: ".concat(e.content.length,"]"):"[No Content]"})})),emailContentBase64:p.emailContentBase64?"[Base64 Content Present - Length: ".concat(p.emailContentBase64.length,"]"):"[No Content]"}),console.log(JSON.stringify(g,null,2)),a.messageChild(JSON.stringify(p)),console.log("Step 7: 'emailData' sent to dialog."),[3,8];case 7:v=y.sent(),console.error("Error processing data_request inside dialog handler:",v);try{a.messageChild(JSON.stringify({error:"Failed to prepare email data: "+v.message}))}catch(e){console.error("Failed to send error message back to dialog",e)}return[3,8];case 8:return[3,10];case 9:if("upload_success"===t.message){console.log("Received 'upload_success' from dialog. Allowing event.");try{a&&a.close()}catch(e){}n&&"function"==typeof n.completed&&n.completed({allowEvent:!0})}else if("operation_cancelled"===t.message||"close_dialog"===t.message){console.log("Received '".concat(t.message,"' from dialog. Stopping event."));try{a&&a.close()}catch(e){}n&&"function"==typeof n.completed&&n.completed({allowEvent:!1,errorMessage:"Operation cancelled by user."})}else console.warn("Received unknown message from dialog: ".concat(t.message));y.label=10;case 10:return[2]}var b}))}))})),console.log("Step 3: Dialog handlers successfully added."),t()):(console.error("Error opening dialog: Code="+f.error.code+" Message="+f.error.message),u(new Error("Could not open the add-in dialog: "+f.error.message)))}))}))];case 3:return f.sent(),[3,5];case 4:u=f.sent(),console.error("--- validateBeforeSend failed ---"),console.error("Error during validateBeforeSend execution:",u);try{a&&a.close()}catch(e){}return n&&"function"==typeof n.completed?(console.log("Completing event with allowEvent: false due to error."),n.completed({allowEvent:!1,errorMessage:"Add-in execution failed: ".concat(u.message)})):console.warn("Event object or event.completed function not available. Cannot signal failure to Outlook."),[3,5];case 5:return[2]}}))}))})),console.log("Office.actions.associate('validateBeforeSend', validateBeforeSend) called.")}()},64583:function(e,t,n){e.exports=function(){"use strict";function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,r=void 0,i=void 0,c=function(e,t){h[o]=e,h[o+1]=t,2===(o+=2)&&(i?i(p):b())};var s="undefined"!=typeof window?window:void 0,a=s||{},l=a.MutationObserver||a.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(p,1)}}var h=new Array(1e3);function p(){for(var e=0;e<o;e+=2)(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0;o=0}var g,v,m,y,b=void 0;function w(e,t){var n=this,o=new this.constructor(E);void 0===o[S]&&M(o);var r=n._state;if(r){var i=arguments[r-1];c((function(){return j(r,o,i,n._result)}))}else F(n,o,e,t);return o}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(E);return C(t,e),t}b=u?function(){return process.nextTick(p)}:l?(v=0,m=new l(p),y=document.createTextNode(""),m.observe(y,{characterData:!0}),function(){y.data=v=++v%2}):f?((g=new MessageChannel).port1.onmessage=p,function(){return g.port2.postMessage(0)}):void 0===s?function(){try{var e=Function("return this")().require("vertx");return void 0!==(r=e.runOnLoop||e.runOnContext)?function(){r(p)}:d()}catch(e){return d()}}():d();var S=Math.random().toString(36).substring(2);function E(){}var O=void 0,x=1,A=2;function T(t,n,o){n.constructor===t.constructor&&o===w&&n.constructor.resolve===_?function(e,t){t._state===x?R(e,t._result):t._state===A?k(e,t._result):F(t,void 0,(function(t){return C(e,t)}),(function(t){return k(e,t)}))}(t,n):void 0===o?R(t,n):e(o)?function(e,t,n){c((function(e){var o=!1,r=function(e,t,n,o){try{e.call(t,n,o)}catch(e){return e}}(n,t,(function(n){o||(o=!0,t!==n?C(e,n):R(e,n))}),(function(t){o||(o=!0,k(e,t))}),e._label);!o&&r&&(o=!0,k(e,r))}),e)}(t,n,o):R(t,n)}function C(e,t){if(e===t)k(e,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(o=t),null===o||"object"!==r&&"function"!==r)R(e,t);else{var n=void 0;try{n=t.then}catch(t){return void k(e,t)}T(e,t,n)}var o,r}function I(e){e._onerror&&e._onerror(e._result),D(e)}function R(e,t){e._state===O&&(e._result=t,e._state=x,0!==e._subscribers.length&&c(D,e))}function k(e,t){e._state===O&&(e._state=A,e._result=t,c(I,e))}function F(e,t,n,o){var r=e._subscribers,i=r.length;e._onerror=null,r[i]=t,r[i+x]=n,r[i+A]=o,0===i&&e._state&&c(D,e)}function D(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var o=void 0,r=void 0,i=e._result,c=0;c<t.length;c+=3)o=t[c],r=t[c+n],o?j(n,o,r,i):r(i);e._subscribers.length=0}}function j(t,n,o,r){var i=e(o),c=void 0,s=void 0,a=!0;if(i){try{c=o(r)}catch(e){a=!1,s=e}if(n===c)return void k(n,new TypeError("A promises callback cannot return that same promise."))}else c=r;n._state!==O||(i&&a?C(n,c):!1===a?k(n,s):t===x?R(n,c):t===A&&k(n,c))}var B=0;function M(e){e[S]=B++,e._state=void 0,e._result=void 0,e._subscribers=[]}var P=function(){function e(e,n){this._instanceConstructor=e,this.promise=new e(E),this.promise[S]||M(this.promise),t(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&R(this.promise,this._result))):k(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===O&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,o=n.resolve;if(o===_){var r=void 0,i=void 0,c=!1;try{r=e.then}catch(e){c=!0,i=e}if(r===w&&e._state!==O)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===N){var s=new n(E);c?k(s,i):T(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(o(e),t)},e.prototype._settledAt=function(e,t,n){var o=this.promise;o._state===O&&(this._remaining--,e===A?k(o,n):this._result[t]=n),0===this._remaining&&R(o,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;F(e,void 0,(function(e){return n._settledAt(x,t,e)}),(function(e){return n._settledAt(A,t,e)}))},e}();var N=function(){function t(e){this[S]=B++,this._result=this._state=void 0,this._subscribers=[],E!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){C(e,t)}),(function(t){k(e,t)}))}catch(t){k(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this,o=n.constructor;return e(t)?n.then((function(e){return o.resolve(t()).then((function(){return e}))}),(function(e){return o.resolve(t()).then((function(){throw e}))})):n.then(t,t)},t}();return N.prototype.then=w,N.all=function(e){return new P(this,e).promise},N.race=function(e){var n=this;return t(e)?new n((function(t,o){for(var r=e.length,i=0;i<r;i++)n.resolve(e[i]).then(t,o)})):new n((function(e,t){return t(new TypeError("You must pass an array to race."))}))},N.resolve=_,N.reject=function(e){var t=new this(E);return k(t,e),t},N._setScheduler=function(e){i=e},N._setAsap=function(e){c=e},N._asap=c,N.polyfill=function(){var e=void 0;if(void 0!==n.g)e=n.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var o=null;try{o=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===o&&!t.cast)return}e.Promise=N},N.Promise=N,N}()}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(63924)}();
//# sourceMappingURL=commands.js.map